# Ketama Hashing

This repository contains implementations of the Ketama Hashing algorithm in Go and C.

## Algorithm Introduction

Ketama Hashing is a specific implementation of consistent hashing, famously used in Memcached. It's a variation of the traditional hash ring approach, but with a precise method for distributing virtual nodes and using MD5 as the hashing function.

**How it works:**

1.  **MD5 Hashing:** Ketama uses the MD5 hash function to map both server names and keys to points on the hash ring.
2.  **Virtual Node Distribution:** For each physical server, multiple virtual nodes are placed on the ring. A common practice is to generate 160 virtual nodes per server (because MD5 produces a 128-bit hash, which can be interpreted as 4 32-bit integers, and 40 such points are generated per server, resulting in 40 * 4 = 160 virtual nodes). These virtual nodes are generated by hashing combinations of the server name and an index (e.g., `MD5(server_name + i)`).
3.  **Key Mapping:** To map a key, its MD5 hash is calculated. The key is then assigned to the first virtual node encountered when moving clockwise from the key's position on the ring.

**Key Features:**

*   **Good Distribution:** The large number of virtual nodes (typically 160 per server) ensures a very even distribution of keys across servers.
*   **Minimal Reassignments:** Similar to other consistent hashing algorithms, it minimizes the number of keys that need to be remapped when servers are added or removed.
*   **Widely Used:** Proven in production systems like Memcached.

## Go Implementation

### Files:

*   `go/ketama.go`: Contains the `KetamaRing` struct and its methods.
*   `go/ketama_test.go`: Contains basic tests to demonstrate the algorithm's behavior, including observing key distribution changes when nodes are added or removed.

### How to Run Tests:

Navigate to the `go` directory and run the tests:

```bash
cd go
go test -v
```

**Expected Output:**
The test output will show the distribution of keys across nodes before and after adding/removing nodes, demonstrating the consistent remapping behavior.

## C Implementation

### Files:

*   `c/ketama.h`: Header file for the Ketama hash ring functions.
*   `c/ketama.c`: Source file containing the Ketama hash ring implementation (with a simplified MD5 placeholder).
*   `c/test_ketama.c`: Main file with test cases to demonstrate node addition/removal and key re-distribution.
*   `c/Makefile`: Makefile for compiling the C code.

### How to Compile and Run Tests:

Navigate to the `c` directory, compile, and then run the executable:

```bash
cd c
make
./test_ketama
```

**Expected Output:**
Similar to the Go version, the C test output will display key distributions and show the impact of server changes.
